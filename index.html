<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3DMAKES - Gestionale Clienti</title>
    <link rel="stylesheet" href="style.css?v=2.1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="logo.png" alt="3DMAKES" class="logo">
                <div class="cloud-status" id="cloudStatus" onclick="showCloudSettings()">
                    <span class="cloud-icon" title="Sincronizzazione cloud">‚òÅÔ∏è</span>
                    <span class="cloud-text">Locale</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Cerca cliente...">
                </div>
                <button class="btn-primary" id="addClientBtn">+ Nuovo Cliente</button>
                <button class="btn-secondary" id="viewReportsBtn" style="margin-top: 8px; width: 100%;">üìä Report Completo</button>
                <button class="btn-secondary" id="viewExpensesBtn" style="margin-top: 8px; width: 100%;">üí∏ Gestione Uscite</button>
            </div>

            <div class="clients-list" id="clientsList">
                <!-- Clienti verranno inseriti qui dinamicamente -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">üëã</div>
                <h2>Benvenuto nel tuo Gestionale</h2>
                <p>Inizia aggiungendo il tuo primo cliente per gestire documenti, ordini e note.</p>
                <button class="btn-primary" onclick="document.getElementById('addClientBtn').click()">+ Aggiungi Cliente</button>
            </div>

            <!-- Expenses View -->
            <div class="report-view" id="expensesView" style="display: none;">
                <div class="report-header">
                    <div>
                        <h2>üí∏ Gestione Uscite</h2>
                        <p>Registra tutte le spese aziendali</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-primary" id="addExpenseBtn">+ Nuova Uscita</button>
                        <button class="btn-secondary" id="closeExpensesBtn">‚úï Chiudi</button>
                    </div>
                </div>

                <div class="expenses-list" id="expensesList">
                    <div class="empty-section">
                        <p>Nessuna uscita registrata</p>
                    </div>
                </div>
            </div>

            <!-- Report View Unificato -->
            <div class="report-view" id="reportView" style="display: none;">
                <div class="report-header">
                    <div>
                        <h2>üìä Report Completo</h2>
                        <p>Analisi ordini e clienti acquisiti per periodo</p>
                    </div>
                    <button class="btn-secondary" id="closeReportBtn">‚úï Chiudi</button>
                </div>

                <div class="report-filters">
                    <div class="filter-group">
                        <label>Periodo</label>
                        <select id="reportPeriod">
                            <option value="week">üìÖ Questa Settimana</option>
                            <option value="month" selected>üìÖ Questo Mese</option>
                            <option value="quarter">üìÖ Questo Trimestre</option>
                            <option value="year">üìÖ Quest'Anno</option>
                            <option value="all">üìÖ Tutti i Periodi</option>
                            <option value="custom">üìÖ Periodo Personalizzato</option>
                        </select>
                    </div>
                    
                    <div class="filter-group custom-dates" id="customDates" style="display: none;">
                        <label>Da</label>
                        <input type="date" id="reportDateFrom">
                        <label>A</label>
                        <input type="date" id="reportDateTo">
                    </div>

                    <div class="filter-group">
                        <label>Cliente</label>
                        <select id="reportClient" onchange="generateReport()">
                            <option value="all">Tutti i Clienti</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Stato</label>
                        <select id="reportStatus" onchange="generateReport()">
                            <option value="all">Tutti gli Stati</option>
                            <option value="in_lavorazione">In Lavorazione</option>
                            <option value="completato">Completato</option>
                            <option value="in_attesa">In Attesa</option>
                            <option value="annullato">Annullato</option>
                        </select>
                    </div>
                </div>

                <!-- Report Summary -->
                <div class="report-summary" id="reportSummary">
                    <div class="summary-card">
                        <div class="summary-icon">üë•</div>
                        <div class="summary-content">
                            <div class="summary-label">Nuovi Clienti</div>
                            <div class="summary-value" id="totalNewClients">0</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üì¶</div>
                        <div class="summary-content">
                            <div class="summary-label">Totale Ordini</div>
                            <div class="summary-value" id="totalOrders">0</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üí∞</div>
                        <div class="summary-content">
                            <div class="summary-label">Incassi Totali</div>
                            <div class="summary-value" id="totalRevenue">CHF 0.00</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üí∏</div>
                        <div class="summary-content">
                            <div class="summary-label">Uscite Totali</div>
                            <div class="summary-value" id="totalExpenses">CHF 0.00</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üìä</div>
                        <div class="summary-content">
                            <div class="summary-label">Bilancio</div>
                            <div class="summary-value" id="totalBalance">CHF 0.00</div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">‚úÖ</div>
                        <div class="summary-content">
                            <div class="summary-label">Completati</div>
                            <div class="summary-value" id="completedOrders">0</div>
                        </div>
                    </div>
                </div>
                
                <!-- Sezione Clienti Acquisiti -->
                <div class="report-section">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px;">üë• Clienti Acquisiti</h3>
                    <div class="report-table-container" style="margin-bottom: 32px;">
                        <div class="report-table-wrapper">
                            <table class="report-table">
                                <thead>
                                    <tr>
                                        <th>Data Registrazione</th>
                                        <th>Cliente</th>
                                        <th>Contatti</th>
                                        <th>N¬∞ Ordini</th>
                                        <th>Valore Totale</th>
                                    </tr>
                                </thead>
                                <tbody id="clientsAcquiredTableBody">
                                    <tr>
                                        <td colspan="5" class="empty-report">Nessun nuovo cliente in questo periodo</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sezione Uscite/Spese -->
                <div class="report-section">
                    <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 16px;">üí∏ Uscite/Spese</h3>
                    <div class="report-table-container" style="margin-bottom: 32px;">
                        <div class="report-table-wrapper">
                            <table class="report-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Descrizione</th>
                                        <th>Categoria</th>
                                        <th>Importo</th>
                                    </tr>
                                </thead>
                                <tbody id="expensesTableBody">
                                    <tr>
                                        <td colspan="4" class="empty-report">Nessuna uscita in questo periodo</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Report Table -->
                <div class="report-table-container">
                    <div class="report-actions">
                        <h3>Dettaglio Ordini</h3>
                        <div>
                            <button class="btn-small" id="exportCSVBtn">üìÑ Esporta CSV</button>
                            <button class="btn-small" id="printReportBtn">üñ®Ô∏è Stampa</button>
                        </div>
                    </div>
                    <div class="report-table-wrapper">
                        <table class="report-table" id="reportTable">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Cliente</th>
                                    <th>N¬∞ Ordine</th>
                                    <th>Descrizione</th>
                                    <th>Stato</th>
                                    <th>Importo</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody">
                                <tr>
                                    <td colspan="6" class="empty-report">Seleziona i filtri e genera il report</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="client-detail" id="clientDetail" style="display: none;">
                <!-- Bottone Indietro Mobile -->
                <button class="btn-back-mobile" id="backToListBtn" onclick="backToClientList()">
                    ‚Üê Torna alla Lista
                </button>
                
                <!-- Header Cliente -->
                <div class="client-header">
                    <div class="client-header-info">
                        <h2 id="clientName"></h2>
                        <p id="clientInfo"></p>
                    </div>
                    <div class="client-header-actions">
                        <button class="btn-secondary" id="editClientBtn">‚úèÔ∏è Modifica</button>
                        <button class="btn-danger" id="deleteClientBtn">üóëÔ∏è Elimina</button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab-btn active" data-tab="documents">üìÑ Documenti</button>
                    <button class="tab-btn" data-tab="files">üìé File</button>
                    <button class="tab-btn" data-tab="notes">üìù Note</button>
                    <button class="tab-btn" data-tab="orders">üõí Ordini</button>
                </div>

                <!-- Tab Content: Documenti -->
                <div class="tab-content active" id="documentsTab">
                    <div class="section-header">
                        <h3>Documenti</h3>
                        <button class="btn-small" id="addDocumentBtn">+ Aggiungi Documento</button>
                    </div>
                    <div class="documents-grid" id="documentsList">
                        <div class="empty-section">
                            <p>Nessun documento caricato</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Note -->
                <div class="tab-content" id="notesTab">
                    <div class="section-header">
                        <h3>Note</h3>
                        <button class="btn-small" id="addNoteBtn">+ Nuova Nota</button>
                    </div>
                    <div class="notes-list" id="notesList">
                        <div class="empty-section">
                            <p>Nessuna nota presente</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: File -->
                <div class="tab-content" id="filesTab">
                    <div class="section-header">
                        <h3>File</h3>
                        <button class="btn-small" id="addFileBtn">+ Carica File</button>
                    </div>
                    <div class="files-grid" id="filesList">
                        <div class="empty-section">
                            <p>Nessun file caricato</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Note -->
                <div class="tab-content" id="notesTab">
                    <div class="section-header">
                        <h3>Note</h3>
                        <button class="btn-small" id="addNoteBtn">+ Nuova Nota</button>
                    </div>
                    <div class="notes-list" id="notesList">
                        <div class="empty-section">
                            <p>Nessuna nota presente</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Ordini -->
                <div class="tab-content" id="ordersTab">
                    <div class="section-header">
                        <h3>Ordini</h3>
                        <button class="btn-small" id="addOrderBtn">+ Nuovo Ordine</button>
                    </div>
                    <div class="orders-list" id="ordersList">
                        <div class="empty-section">
                            <p>Nessun ordine presente</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Cliente -->
    <div class="modal" id="clientModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalClientTitle">Nuovo Cliente</h3>
                <button class="modal-close" onclick="closeModal('clientModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nome/Ragione Sociale *</label>
                    <input type="text" id="modalClientName" required>
                </div>
                <div class="form-group">
                    <label>üìÖ Data Acquisizione Cliente *</label>
                    <input type="date" id="modalClientAcquisitionDate" required>
                    <small style="color: var(--text-secondary); font-size: 12px;">
                        üí° Data in cui il cliente √® stato acquisito (per report e statistiche)
                    </small>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="modalClientEmail">
                </div>
                <div class="form-group">
                    <label>Telefono</label>
                    <input type="tel" id="modalClientPhone">
                </div>
                <div class="form-group">
                    <label>Indirizzo</label>
                    <input type="text" id="modalClientAddress">
                </div>
                <div class="form-group">
                    <label>P.IVA / Codice Fiscale</label>
                    <input type="text" id="modalClientVat">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('clientModal')">Annulla</button>
                <button class="btn-primary" id="saveClientBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal Documento -->
    <div class="modal" id="documentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Aggiungi Documento</h3>
                <button class="modal-close" onclick="closeModal('documentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Tipo Documento *</label>
                    <select id="modalDocType">
                        <option value="fattura">üìÑ Fattura</option>
                        <option value="preventivo">üìã Preventivo</option>
                        <option value="contratto">üìù Contratto</option>
                        <option value="altro">üìÅ Altro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Numero/Riferimento *</label>
                    <input type="text" id="modalDocNumber" placeholder="es. FT-2025-001">
                </div>
                <div class="form-group">
                    <label>Importo (CHF)</label>
                    <input type="number" id="modalDocAmount" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="modalDocDate">
                </div>
                <div class="form-group">
                    <label>Carica File (opzionale)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="modalDocFileInput" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png">
                        <div class="file-input-display" id="docFileInputDisplay">
                            <span class="file-input-icon">üìÅ</span>
                            <span class="file-input-text">Carica PDF, Word, Excel o immagine</span>
                        </div>
                    </div>
                    <small style="color: var(--text-secondary); font-size: 12px;">
                        üí° Carica il file del documento (fattura PDF, preventivo Word, etc.)
                    </small>
                </div>
                <div class="form-group">
                    <label>Note</label>
                    <textarea id="modalDocNotes" rows="3"></textarea>
                </div>
                <div id="docFileInfo" class="file-info-display" style="display: none;">
                    <div class="file-info-item">
                        <strong>File:</strong> <span id="docFileInfoName"></span>
                    </div>
                    <div class="file-info-item">
                        <strong>Dimensione:</strong> <span id="docFileInfoSize"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('documentModal')">Annulla</button>
                <button class="btn-primary" id="saveDocumentBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal Nota -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalNoteTitle">Nuova Nota</h3>
                <button class="modal-close" onclick="closeModal('noteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Titolo</label>
                    <input type="text" id="modalNoteTitle-input" placeholder="Titolo della nota">
                </div>
                <div class="form-group">
                    <label>Contenuto *</label>
                    <textarea id="modalNoteContent" rows="8" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('noteModal')">Annulla</button>
                <button class="btn-primary" id="saveNoteBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal Ordine -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalOrderTitle">Nuovo Ordine</h3>
                <button class="modal-close" onclick="closeModal('orderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Numero Ordine *</label>
                    <input type="text" id="modalOrderNumber" placeholder="es. ORD-2025-001">
                </div>
                <div class="form-group">
                    <label>Descrizione *</label>
                    <textarea id="modalOrderDescription" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label>Importo (CHF)</label>
                    <input type="number" id="modalOrderAmount" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Data Ordine</label>
                    <input type="date" id="modalOrderDate">
                </div>
                <div class="form-group">
                    <label>Stato *</label>
                    <select id="modalOrderStatus">
                        <option value="in_lavorazione">üî® In Lavorazione</option>
                        <option value="completato">‚úÖ Completato</option>
                        <option value="in_attesa">‚è≥ In Attesa</option>
                        <option value="annullato">‚ùå Annullato</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üí≥ Stato Pagamento *</label>
                    <select id="modalOrderPaymentStatus">
                        <option value="non_pagato">‚ùå Non Pagato</option>
                        <option value="parziale">‚è≥ Pagamento Parziale</option>
                        <option value="pagato">‚úÖ Pagato</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Metodo Pagamento</label>
                    <select id="modalOrderPaymentMethod">
                        <option value="">-- Seleziona --</option>
                        <option value="contanti">üíµ Contanti</option>
                        <option value="bonifico">üè¶ Bonifico</option>
                        <option value="carta">üí≥ Carta</option>
                        <option value="twint">üì± TWINT</option>
                        <option value="paypal">üÖøÔ∏è PayPal</option>
                        <option value="altro">üìã Altro</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('orderModal')">Annulla</button>
                <button class="btn-primary" id="saveOrderBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal Impostazioni Cloud -->
    <div class="modal" id="cloudSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚òÅÔ∏è Impostazioni Cloud</h3>
                <button class="modal-close" onclick="closeModal('cloudSettingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>User ID Attuale</label>
                    <input type="text" id="currentUserId" readonly style="background: #f1f5f9;">
                    <small style="color: var(--text-secondary); font-size: 12px;">
                        ‚ÑπÔ∏è Questo ID identifica i tuoi dati nel cloud
                    </small>
                </div>
                
                <div class="form-group">
                    <label>üë• Database Condiviso</label>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                        <strong>‚úÖ Tutti vedono gli stessi dati automaticamente!</strong><br>
                        Tu e i tuoi colleghi avete accesso allo stesso database in tempo reale.
                    </p>
                    <div style="padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.2);">
                        <div style="font-size: 13px; color: var(--primary);">
                            <strong>üìä Vantaggi:</strong><br>
                            ‚Ä¢ Modifiche visibili istantaneamente<br>
                            ‚Ä¢ Nessuna configurazione necessaria<br>
                            ‚Ä¢ Sincronizzazione automatica<br>
                            ‚Ä¢ Stesso database su tutti i dispositivi
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Stato Sincronizzazione</label>
                    <div id="cloudSyncStatus" style="padding: 10px; background: var(--bg-tertiary); border-radius: 6px; font-size: 13px;">
                        Caricamento...
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('cloudSettingsModal')">Chiudi</button>
                <button class="btn-primary" onclick="changeUserId()">üíæ Cambia User ID</button>
            </div>
        </div>
    </div>

    <!-- Modal Uscita/Spesa -->
    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalExpenseTitle">Nuova Uscita</h3>
                <button class="modal-close" onclick="closeModal('expenseModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Data *</label>
                    <input type="date" id="modalExpenseDate" required>
                </div>
                <div class="form-group">
                    <label>Descrizione *</label>
                    <textarea id="modalExpenseDescription" rows="3" required placeholder="Descrivi la spesa..."></textarea>
                </div>
                <div class="form-group">
                    <label>Categoria *</label>
                    <select id="modalExpenseCategory">
                        <option value="materiali">üîß Materiali</option>
                        <option value="fornitori">üè≠ Fornitori</option>
                        <option value="stipendi">üë§ Stipendi</option>
                        <option value="affitto">üè¢ Affitto/Utenze</option>
                        <option value="trasporti">üöó Trasporti</option>
                        <option value="marketing">üì¢ Marketing</option>
                        <option value="software">üíª Software/Abbonamenti</option>
                        <option value="tasse">üìã Tasse/Imposte</option>
                        <option value="altro">üìÅ Altro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Importo (CHF) *</label>
                    <input type="number" id="modalExpenseAmount" step="0.01" placeholder="0.00" required>
                </div>
                <div class="form-group">
                    <label>Note</label>
                    <textarea id="modalExpenseNotes" rows="2" placeholder="Note aggiuntive..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('expenseModal')">Annulla</button>
                <button class="btn-primary" id="saveExpenseBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Modal File -->
    <div class="modal" id="fileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Carica File</h3>
                <button class="modal-close" onclick="closeModal('fileModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Seleziona File *</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="modalFileInput" accept="*/*">
                        <div class="file-input-display" id="fileInputDisplay">
                            <span class="file-input-icon">üìÅ</span>
                            <span class="file-input-text">Clicca per scegliere un file o trascinalo qui</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Descrizione</label>
                    <input type="text" id="modalFileDescription" placeholder="Descrizione opzionale del file">
                </div>
                <div id="fileInfoDisplay" class="file-info-display" style="display: none;">
                    <div class="file-info-item">
                        <strong>Nome:</strong> <span id="fileInfoName"></span>
                    </div>
                    <div class="file-info-item">
                        <strong>Tipo:</strong> <span id="fileInfoType"></span>
                    </div>
                    <div class="file-info-item">
                        <strong>Dimensione:</strong> <span id="fileInfoSize"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('fileModal')">Annulla</button>
                <button class="btn-primary" id="saveFileBtn">Carica</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=2.1"></script>
</body>
</html>

